---
title: 'Test coverage'
sidebar:
  order: 5
  title: Test coverage
---

# Test Coverage in Storybook

Test coverage is a crucial metric that helps you understand how well your tests are exercising your code. It identifies which parts of your code are tested and which parts need more attention, helping you maintain high-quality, reliable components.

## Why Test Coverage Matters

- **Quality Assurance**: Ensures comprehensive testing of your components
- **Risk Management**: Identifies untested code paths
- **Maintenance**: Helps maintain test quality over time
- **Documentation**: Shows which parts of your code are verified
- **CI/CD**: Integrates with your development workflow

## Getting Started

### 1. Install Required Packages

```bash
# Install Vitest addon
npx storybook add @storybook/test-runner

# Install coverage support
npm install -D @vitest/coverage-v8
```

### 2. Basic Configuration

Add to your `vitest.config.ts`:

```ts
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        '.storybook/',
        '**/*.stories.tsx',
      ],
    },
  },
});
```

## Using Test Coverage

### 1. In Storybook UI

Enable coverage in the testing widget:

```tsx
// .storybook/preview.ts
const preview: Preview = {
  parameters: {
    test: {
      coverage: {
        enabled: true,
        watermarks: {
          statements: [50, 80],
          branches: [50, 80],
          functions: [50, 80],
          lines: [50, 80],
        },
      },
    },
  },
};
```

### 2. In CI Pipeline

```yaml
# .github/workflows/test.yml
name: Test Coverage
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - name: Run tests with coverage
        run: npm run test:coverage
      - name: Upload coverage report
        uses: codecov/codecov-action@v3
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
```

## Coverage Types

### 1. Statement Coverage

```tsx
// Button.tsx
export const Button = ({ onClick, children }) => {
  // This line is covered if the component renders
  const handleClick = () => {
    // This line is covered if onClick is called
    onClick?.();
  };

  return (
    <button onClick={handleClick}>
      {children}
    </button>
  );
};
```

### 2. Branch Coverage

```tsx
// Form.tsx
export const Form = ({ onSubmit, isDisabled }) => {
  // This branch is covered if both conditions are tested
  if (isDisabled) {
    return <div>Form is disabled</div>;
  }

  return (
    <form onSubmit={onSubmit}>
      {/* Form content */}
    </form>
  );
};
```

### 3. Function Coverage

```tsx
// Utils.ts
export const formatDate = (date: Date) => {
  // This function is covered if it's called
  return date.toLocaleDateString();
};

export const validateEmail = (email: string) => {
  // This function is covered if it's called
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
};
```

## Best Practices

1. **Set Realistic Goals**
   - Start with basic coverage requirements
   - Gradually increase coverage targets
   - Focus on critical code paths

2. **Coverage Configuration**
   - Exclude test files and utilities
   - Set appropriate watermarks
   - Use multiple coverage reporters

3. **Test Organization**
   - Group related tests
   - Use descriptive test names
   - Maintain test independence

4. **CI Integration**
   - Run coverage in CI pipeline
   - Enforce coverage thresholds
   - Track coverage trends

## Common Issues and Solutions

### 1. Low Coverage

```tsx
// Component with low coverage
export const ComplexComponent = ({ data }) => {
  // Add tests for these conditions
  if (!data) return null;
  if (data.error) return <ErrorComponent />;
  if (data.loading) return <LoadingComponent />;
  
  return <div>{data.content}</div>;
};
```

### 2. False Negatives

```tsx
// Ignore specific lines
export const Component = () => {
  // This line is intentionally not tested
  /* istanbul ignore next */
  const handleError = () => {
    console.error('Error occurred');
  };
  
  return <div>Content</div>;
};
```

## Advanced Configuration

### 1. Custom Coverage Rules

```ts
// vitest.config.ts
export default defineConfig({
  test: {
    coverage: {
      rules: {
        // Custom rules for specific files
        'src/components/**/*.tsx': {
          statements: 80,
          branches: 70,
          functions: 80,
          lines: 80,
        },
      },
    },
  },
});
```

### 2. Coverage Reports

```ts
// vitest.config.ts
export default defineConfig({
  test: {
    coverage: {
      reporter: [
        'text',
        'json',
        'html',
        'lcov',
        'clover',
      ],
      reportsDirectory: './coverage',
    },
  },
});
```

## Additional Resources

- [Vitest Coverage Documentation](https://vitest.dev/guide/coverage.html)
- [Istanbul Coverage Documentation](https://istanbul.js.org/)
- [Code Coverage Best Practices](https://martinfowler.com/bliki/TestCoverage.html)
- [Storybook Testing Guide](https://storybook.js.org/docs/writing-tests/introduction)

<Callout variant="info">
Remember: High test coverage doesn't guarantee qualityâ€”it's just one metric. Focus on writing meaningful tests that verify your components' behavior.
</Callout>
